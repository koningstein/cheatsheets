<!DOCTYPE html>
<html lang="nl" data-theme="light" data-color="blue">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create (Insert) - OOP PHP Module 8</title>

    <script src="../../../../assets/js/theme-init.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="../../../../assets/css/style.css">
</head>
<body>

<div data-include="../../../../components/header.html"></div>

<div class="layout-wrapper">
    <div data-include="../../../../components/sidebar.html"></div>

    <main class="main-content">
        <h1>Create: Data Opslaan</h1>

        <div class="info-box">
            <h3>Het Gevaar van Input</h3>
            <p>Het opslaan van data is een kritiek punt in je applicatie. Als je gebruikersinput direct in je SQL-string plakt, ben je kwetsbaar voor <strong>SQL Injection</strong>. Kwaadwillenden kunnen dan je database manipuleren.</p>
        </div>



        <h3>De Oplossing: Prepared Statements & Binding</h3>
        <p>Om dit te voorkomen, gebruiken we <strong>Prepared Statements</strong>. Het proces bestaat uit drie stappen:</p>
        <ol>
            <li><strong>Prepare:</strong> Je stuurt de query naar de database met placeholders (<code>:name</code>) in plaats van waarden.</li>
            <li><strong>Bind:</strong> Je koppelt de waarden veilig aan de placeholders met <code>bindValue()</code>.</li>
            <li><strong>Execute:</strong> Je voert de query uit.</li>
        </ol>



        <h3>De Insert Methode Implementeren</h3>
        <p>We bouwen een generieke `insert` methode in onze database class. Deze accepteert een tabelnaam en een array met data.</p>

        <pre><code class="language-php">// MysqlDatabase.php

public function insert(string $table, array $data): int
{
    // Stap 1: Bouw de query dynamisch op
    // We maken een string van kolomnamen: "name, points"
    $columns = implode(', ', array_keys($data));

    // We maken een string van placeholders: ":name, :points"
    $placeholders = ':' . implode(', :', array_keys($data));

    $sql = "INSERT INTO $table ($columns) VALUES ($placeholders)";

    // Stap 2: Prepare de query
    $stmt = $this->connection->prepare($sql);

    // Stap 3: Bind elke waarde apart
    // Dit zorgt voor maximale controle en veiligheid
    foreach ($data as $column => $value) {
        // We binden de waarde aan de placeholder (bijv. :name wordt 'John')
        $stmt->bindValue(":$column", $value);
    }

    // Stap 4: Execute de statement
    $stmt->execute();

    // Retourneer het ID van het nieuwe record (handig voor checks)
    return (int)$this->connection->lastInsertId();
}</code></pre>

        <h3>Toepassing in Blackjack</h3>
        <p>Stel dat de speler "John" 21 punten heeft gehaald. We slaan dit op via een Score object. De class geeft alleen het resultaat terug.</p>

        <pre><code class="language-php">// Score.php

class Score
{
    // Geeft het ID van de opgeslagen score terug
    public function save(string $playerName, int $points): int
    {
        $db = DatabaseManager::getConnection();

        // De data array
        $data = [
            'name'   => $playerName,
            'points' => $points
        ];

        // De insert methode regelt de veilige binding
        // We returnen het resultaat (geen echo!)
        return $db->insert('scores', $data);
    }
}</code></pre>

        <p>In je controller of index bestand gebruik je de class en toon je het resultaat.</p>

        <pre><code class="language-php">// index.php

$score = new Score();
$newId = $score->save('John', 21);

echo "Score opgeslagen! ID: $newId";</code></pre>

        <div class="info-box">
            <h3>Waarom bindValue?</h3>
            <p>Met <code>bindValue()</code> dwingt PDO af dat de data als <em>waarde</em> wordt behandeld, nooit als uitvoerbare code. Zelfs als iemand <code>DROP TABLE scores</code> als naam invult, ziet de database dit gewoon als een veilige string: <code>"DROP TABLE scores"</code>.</p>
        </div>

        <div class="info-box">
            <h3>Samenvatting</h3>
            <ul>
                <li><strong>Placeholder:</strong> Gebruik <code>:kolomnaam</code> in je SQL query.</li>
                <li><strong>BindValue:</strong> Koppel in een loop elke waarde aan de juiste placeholder.</li>
                <li><strong>Veiligheid:</strong> Dit is de enige juiste manier om gebruikersinput op te slaan.</li>
            </ul>
        </div>

    </main>

    <aside class="sidebar-right">
        <div class="toc-container">
            <h4>Inhoud</h4>
            <ul id="toc-list" class="toc-list">
            </ul>
        </div>
    </aside>
</div>

<div data-include="../../../../components/footer.html"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="../../../../assets/js/script.js"></script>
</body>
</html>