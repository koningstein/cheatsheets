<!DOCTYPE html>
<html lang="nl" data-theme="light" data-color="blue">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delete - OOP PHP Module 8</title>

    <script src="../../../../assets/js/theme-init.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="../../../../assets/css/style.css">
</head>
<body>

<div data-include="../../../../components/header.html"></div>

<div class="layout-wrapper">
    <div data-include="../../../../components/sidebar.html"></div>

    <main class="main-content">
        <h1>Delete: Data Verwijderen</h1>

        <div class="info-box">
            <h3>Weg is Weg</h3>
            <p>Soms moet data verwijderd worden: een speler stopt, een score is frauduleus, of een item wordt verkocht. De SQL operatie hiervoor is <code>DELETE</code>.</p>
        </div>

        <div class="info-box warning">
            <h3>⚠️ Waarschuwing: De Gevaarlijke Query</h3>
            <p>Net als bij UPDATE is de <code>WHERE</code> clausule hier van levensbelang.
                <br><code>DELETE FROM scores</code> (zonder WHERE) <strong>verwijder alle rijen</strong> uit de tabel. Er is geen "undo" knop in de database.</p>
        </div>



        <h3>De Delete Methode Implementeren</h3>
        <p>Om ongelukken te voorkomen, bouwen we onze `delete` methode zo dat hij weigert iets te doen tenzij we expliciet een ID meegeven.</p>

        <pre><code class="language-php">// Database.php

public function delete(string $table, array $conditions): int
{
    // Stap 1: Veiligheidscheck
    // We eisen dat er een 'id' in de condities zit.
    // Dit voorkomt dat we per ongeluk `delete('scores', [])` aanroepen en alles wissen.
    if (empty($conditions['id'])) {
        throw new Exception("Delete operatie vereist een ID!");
    }

    // Stap 2: Bouw de Query
    // We hardcoden de WHERE clause op ID voor maximale veiligheid.
    $sql = "DELETE FROM $table WHERE id = :id";

    // Stap 3: Prepare
    $stmt = $this->connection->prepare($sql);

    // Stap 4: Bind het ID
    $stmt->bindValue(":id", $conditions['id']);

    // Stap 5: Execute
    $stmt->execute();

    // Retourneer hoeveel rijen zijn verwijderd (meestal 1)
    return $stmt->rowCount();
}</code></pre>

        <h3>Toepassing: Een Score Wissen</h3>
        <p>In onze applicatie kunnen we nu een methode toevoegen aan het `Score` object om zichzelf te verwijderen.</p>

        <pre><code class="language-php">// Score.php

class Score
{
    private ?int $id = null;

    public function remove(): bool
    {
        // Controleer eerst of dit object wel in de database bestaat (heeft het een ID?)
        if ($this->id === null) {
            return false;
        }

        $db = DatabaseManager::getConnection();

        // Roep de veilige delete methode aan
        $deletedRows = $db->delete(
            'scores',           // Tabel
            ['id' => $this->id] // Conditie
        );

        if ($deletedRows > 0) {
            // Zet ID op null om aan te geven dat het niet meer in de DB staat
            $this->id = null;
            // Return succes (geen echo!)
            return true;
        }

        return false;
    }
}</code></pre>

        <p>In de controller (index.php) roepen we de methode aan en tonen we het resultaat aan de gebruiker.</p>

        <pre><code class="language-php">// index.php

// Stel we hebben een score object opgehaald
if ($score->remove()) {
    echo "Score succesvol verwijderd.";
} else {
    echo "Kon de score niet verwijderen (bestond misschien niet meer?).";
}</code></pre>

        <div class="info-box">
            <h3>Bevestiging Vragen</h3>
            <p>Omdat verwijderen permanent is, is het in de User Interface (UI) gebruikelijk om altijd eerst een bevestiging te vragen ("Weet je zeker dat je dit wilt verwijderen?") voordat je de `delete` methode aanroept. Dit doe je vaak met een aparte bevestigingspagina of een JavaScript popup.</p>
        </div>

        <div class="info-box">
            <h3>Samenvatting</h3>
            <ul>
                <li><strong>DELETE:</strong> Verwijdert rijen permanent.</li>
                <li><strong>Veiligheid:</strong> Implementeer een check die verplicht om een ID mee te geven.</li>
                <li><strong>Resultaat:</strong> Gebruik <code>rowCount()</code> om te zien of het verwijderen gelukt is.</li>
            </ul>
        </div>

    </main>

    <aside class="sidebar-right">
        <div class="toc-container">
            <h4>Inhoud</h4>
            <ul id="toc-list" class="toc-list">
            </ul>
        </div>
    </aside>
</div>

<div data-include="../../../../components/footer.html"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="../../../../assets/js/script.js"></script>
</body>
</html>