<!DOCTYPE html>
<html lang="nl" data-theme="light" data-color="blue">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update - OOP PHP Module 8</title>

    <script src="../../../../assets/js/theme-init.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="../../../../assets/css/style.css">
</head>
<body>

<div data-include="../../../../components/header.html"></div>

<div class="layout-wrapper">
    <div data-include="../../../../components/sidebar.html"></div>

    <main class="main-content">
        <h1>Update: Gegevens Wijzigen</h1>

        <div class="info-box">
            <h3>Bestaande Data Aanpassen</h3>
            <p>Het updaten van data is complexer dan een simpele <code>INSERT</code>. Je moet namelijk twee dingen doorgeven aan de database:</p>
            <ol>
                <li><strong>SET:</strong> De nieuwe waarden (bijv. <code>balance = 500</code>).</li>
                <li><strong>WHERE:</strong> Welk record moet worden aangepast? (bijv. <code>id = 3</code>).</li>
            </ol>
            <p>Zonder een strikte <code>WHERE</code>-clausule overschrijf je per ongeluk de hele tabel. Daarom bouwen we een beveiliging in.</p>
        </div>

        <h3>De Update Methode Implementeren</h3>
        <p>In deze methode verwachten we drie parameters: de tabel, de data die gewijzigd moet worden, en de condities (waarin verplicht een ID moet zitten).</p>



        <pre><code class="language-php">public function update(string $table, array $data, array $conditions): int
{
    // Stap 1: Veiligheidscheck
    // We updaten ALLEEN als we een specifiek ID hebben.
    if (empty($conditions['id'])) {
        throw new Exception("Update vereist een ID voor veiligheid!");
    }

    // Stap 2: Bouw de SET clausule
    // We maken een lijst van "kolom = :placeholder"
    $setParts = [];
    foreach (array_keys($data) as $column) {
        // We gebruiken een prefix 'val_' om verwarring te voorkomen
        $setParts[] = "$column = :val_$column";
    }
    $setString = implode(', ', $setParts);

    // Stap 3: Bouw de query
    // We forceren een WHERE op ID
    $sql = "UPDATE $table SET $setString WHERE id = :id";

    // Stap 4: Prepare
    $stmt = $this->connection->prepare($sql);

    // Stap 5: Bind de DATA (de nieuwe waarden)
    foreach ($data as $column => $value) {
        $stmt->bindValue(":val_$column", $value);
    }

    // Stap 6: Bind het ID (het doelwit)
    $stmt->bindValue(":id", $conditions['id']);

    // Stap 7: Execute
    $stmt->execute();

    // Retourneer het aantal gewijzigde rijen (0 betekent: geen wijziging nodig)
    return $stmt->rowCount();
}</code></pre>

        <div class="info-box">
            <h3>Waarom :val_ prefixen?</h3>
            <p>In de query gebruiken we placeholders zoals <code>:val_name</code> in plaats van <code>:name</code>. Dit doen we om zeker te weten dat de namen van de placeholders in de <code>SET</code>-lijst nooit conflicteren met placeholders in de <code>WHERE</code>-lijst (zoals <code>:id</code>). Het houdt de data en de condities netjes gescheiden.</p>
        </div>

        <h3>Toepassing: Saldo Updaten</h3>
        <p>Stel, speler "John" (ID 5) wint een potje Blackjack. We moeten zijn saldo ophogen.</p>

        <pre><code class="language-php">class Player
{
    private int $id;       // Bijv. 5
    private int $balance;  // Bijv. 100

    public function addWin(int $amount)
    {
        $this->balance += $amount; // Nieuw saldo: 200

        $db = DatabaseManager::getConnection();

        // Roep de update methode aan
        $rowsAffected = $db->update(
            'players',                  // Tabel
            ['balance' => $this->balance], // Data (SET)
            ['id' => $this->id]         // Conditie (WHERE)
        );

        if ($rowsAffected > 0) {
            echo "Database bijgewerkt!";
        }
    }
}</code></pre>

        <div class="info-box">
            <h3>Samenvatting</h3>
            <ul>
                <li><strong>Veiligheid:</strong> Eis altijd een ID bij een update om ongelukken te voorkomen.</li>
                <li><strong>Placeholders:</strong> Gebruik ze voor zowel de nieuwe waarden als het ID.</li>
                <li><strong>Return:</strong> Gebruik <code>rowCount()</code> om te checken of de update succesvol was.</li>
            </ul>
        </div>

    </main>

    <aside class="sidebar-right">
        <div class="toc-container">
            <h4>Inhoud</h4>
            <ul id="toc-list" class="toc-list">
            </ul>
        </div>
    </aside>
</div>

<div data-include="../../../../components/footer.html"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="../../../../assets/js/script.js"></script>
</body>
</html>