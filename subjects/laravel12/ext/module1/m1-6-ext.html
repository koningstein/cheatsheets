<!DOCTYPE html>
<html lang="nl" data-theme="light" data-color="red">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validatie & Flash - Laravel 12 Module 1</title>
    <script src="../../theme-init.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="../../style.css">
</head>
<body>

<div data-include="../../header.html"></div>

<div class="layout-wrapper">
    <div data-include="../../sidebar.html"></div>

    <main class="main-content">
        <h1>Validatie & Flash</h1>
        <p>Om ervoor te zorgen dat we alleen geldige data in de database opslaan, moeten we de invoer van de gebruiker controleren. Dit proces heet <strong>Validatie</strong>. Daarnaast willen we de gebruiker feedback geven (bijvoorbeeld: "Categorie opgeslagen"), dit doen we met <strong>Flash Messages</strong>.</p>

        <div class="info-box" style="background: var(--bg-content); border: 1px solid var(--border-color); padding: 1rem; border-radius: 0.5rem;">
            <h2>Leeruitkomsten</h2>
            <ul style="margin-bottom: 0;">
                <li>Ik begrijp het Design Pattern "Separation of Concerns".</li>
                <li>Ik kan een Form Request aanmaken en instellen.</li>
                <li>Ik kan validatieregels (rules) toepassen op invoervelden.</li>
                <li>Ik kan Dependency Injection toepassen in de Controller.</li>
                <li>Ik kan foutmeldingen (errors) tonen in de View.</li>
                <li>Ik kan ingevulde data behouden (old input) bij fouten.</li>
                <li>Ik kan succesmeldingen (flash messages) tonen.</li>
            </ul>
        </div>

        <h2>Form Requests</h2>
        <p>Je kunt validatie direct in de controller schrijven, maar dat is in Laravel niet "best practice". We willen onze controller schoon en overzichtelijk houden. Daarom gebruiken we een apart bestand voor de validatie: de <strong>Form Request</strong>.</p>

        <div class="info-box" style="background: var(--bg-content); border: 1px solid var(--border-color); padding: 1rem; border-radius: 0.5rem;">
            <strong>Design Pattern: Separation of Concerns</strong><br>
            Dit principe houdt in dat je verschillende verantwoordelijkheden in je code scheidt.
            <ul>
                <li>De <strong>Controller</strong> regelt de flow (verkeer).</li>
                <li>De <strong>Form Request</strong> regelt de validatie (controle).</li>
            </ul>
            Hierdoor is je code makkelijker te lezen, te testen en aan te passen.
        </div>

        <h3>Form Request Aanmaken</h3>
        <p>We maken een request aan via de terminal. Gebruik een duidelijke naam: <code>{Model}{Actie}Request</code>.</p>
        <pre><code class="language-bash">php artisan make:request CategoryStoreRequest</code></pre>

        <p>Het bestand wordt aangemaakt in <code>app/Http/Requests/CategoryStoreRequest.php</code>.</p>

        <h2>Regels Instellen</h2>
        <p>Open het bestand. Je ziet hier twee methodes: <code>authorize()</code> en <code>rules()</code>.</p>

        <h3>Authorize</h3>
        <p>Deze methode bepaalt of de gebruiker deze actie <em>mag</em> uitvoeren. Omdat we nog geen rollen/rechten systeem hebben, zetten we deze voor nu op <strong>true</strong>. Als je dit vergeet, krijg je een "403 Forbidden" foutmelding.</p>

        <pre><code class="language-php">
public function authorize(): bool
{
    return true; // Zet deze op true!
}
        </code></pre>

        <h3>Rules</h3>
        <p>In de <code>rules()</code> methode geef je per invoerveld aan wat de eisen zijn. We gebruiken een array waarbij de 'key' de naam van het HTML-inputveld is.</p>
        <p>Voor onze categorie gelden de volgende regels:</p>
        <ul>
            <li><strong>required:</strong> Het veld mag niet leeg zijn.</li>
            <li><strong>string:</strong> Het moet tekst zijn.</li>
            <li><strong>unique:categories:</strong> De naam mag nog niet bestaan in de tabel 'categories'.</li>
            <li><strong>min:3:</strong> Minimaal 3 tekens.</li>
            <li><strong>max:75:</strong> Maximaal 75 tekens (komt overeen met de database).</li>
        </ul>

        <pre><code class="language-php">
public function rules(): array
{
    return [
        'name' => 'required|string|unique:categories|min:3|max:75',
    ];
}
        </code></pre>

        <h2>Controller Koppelen</h2>
        <p>Nu moeten we de controller vertellen dat hij onze nieuwe <code>CategoryStoreRequest</code> moet gebruiken in plaats van de standaard <code>Request</code>.</p>

        <p>Dit werkt via <strong>Dependency Injection</strong>. Laravel ziet dat je een specifieke class vraagt in de parameters van je functie, en zorgt ervoor dat deze automatisch wordt uitgevoerd <em>voordat</em> de code in je functie begint. Als de validatie faalt, wordt de code in de functie niet eens uitgevoerd!</p>

        <p>Pas de <code>store</code> methode in <code>CategoryController.php</code> aan:</p>

        <pre><code class="language-php">
// Vergeet niet je nieuwe Request te importeren bovenaan!
use App\Http\Requests\CategoryStoreRequest;

public function store(CategoryStoreRequest $request)
{
    // Als we hier komen, is de data geldig!

    $category = new Category();
    $category->name = $request->name;
    $category->save();

    return to_route('admin.categories.index');
}
        </code></pre>

        <h2>Foutmeldingen in View</h2>
        <p>Als de validatie faalt, stuurt Laravel de gebruiker automatisch terug naar het formulier. De foutmeldingen worden meegestuurd in de variabele <code>$errors</code>.</p>
        <p>We tonen deze meldingen in <code>resources/views/admin/categories/create.blade.php</code>.</p>

        <pre><code class="language-html">
@if ($errors->any())
    &lt;div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4"&gt;
        &lt;strong class="font-bold"&gt;Er ging iets mis!&lt;/strong&gt;
        &lt;ul class="mt-2 list-disc list-inside"&gt;
            @foreach ($errors->all() as $error)
                &lt;li&gt;{{ $error }}&lt;/li&gt;
            @endforeach
        &lt;/ul&gt;
    &lt;/div&gt;
@endif
        </code></pre>

        <h3>Specifieke veld foutmeldingen</h3>
        <p>Je kunt ook per veld controleren op fouten en de CSS van het inputveld aanpassen (bijvoorbeeld een rode rand).</p>
        <pre><code class="language-html">
&lt;input type="text" name="name"
       class="border rounded w-full py-2 px-3 @error('name') border-red-500 @enderror"&gt;

@error('name')
    &lt;p class="text-red-500 text-xs italic mt-2"&gt;{{ $message }}&lt;/p&gt;
@enderror
        </code></pre>

        <h2>Old Input (Gebruiksgemak)</h2>
        <p>Niets is irritanter dan een formulier opnieuw moeten invullen omdat je één foutje hebt gemaakt. Laravel heeft hiervoor de <code>old()</code> functie.</p>
        <p>Gebruik dit in het <code>value</code> attribuut van je inputvelden:</p>

        <pre><code class="language-html">
&lt;input type="text" name="name" value="{{ old('name') }}" ... &gt;
        </code></pre>
        <p>Als er nu een validatiefout is, wordt de waarde die de gebruiker had ingevuld teruggezet.</p>

        <h2>Flash Messages</h2>
        <p>Als het opslaan wél lukt, willen we een bevestiging tonen. Dit noemen we een <strong>Flash Message</strong>. Deze data wordt in de sessie opgeslagen, maar is slechts beschikbaar voor <strong>één</strong> volgend verzoek (page load). Daarna wordt het automatisch verwijderd.</p>

        <h3>Stap 1: Message meesturen</h3>
        <p>In de controller voegen we de boodschap toe aan de redirect met <code>with()</code>.</p>

        <pre><code class="language-php">
public function store(CategoryStoreRequest $request)
{
    // ... opslaan code ...

    return to_route('admin.categories.index')
        ->with('status', 'Categorie succesvol aangemaakt!');
}
        </code></pre>

        <h3>Stap 2: Message tonen</h3>
        <p>In de <code>index.blade.php</code> (het overzicht) controleren we of er een 'status' bericht in de sessie zit.</p>

        <pre><code class="language-html">
@if (session('status'))
    &lt;div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert"&gt;
        &lt;span class="block sm:inline"&gt;{{ session('status') }}&lt;/span&gt;
    &lt;/div&gt;
@endif
        </code></pre>

    </main>

    <aside class="sidebar-right">
        <div class="toc-container">
            <h4>Inhoud</h4>
            <ul id="toc-list" class="toc-list">
            </ul>
        </div>
    </aside>
</div>
<div data-include="../../footer.html"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="../../script.js"></script>
</body>
</html>