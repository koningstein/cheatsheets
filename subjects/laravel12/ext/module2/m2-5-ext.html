<!DOCTYPE html>
<html lang="nl" data-theme="light" data-color="red">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 2-5: Middleware & Redirects (Uitgebreid) - Laravel 12 Module 2</title>

    <script src="../../../../assets/js/theme-init.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="../../../../assets/css/style.css">
</head>
<body>

<div data-include="../../../../components/header.html"></div>

<div class="layout-wrapper">
    <div data-include="../../../../components/sidebar.html"></div>

    <main class="main-content">
        <h1>Module 2-5: Middleware & Livewire Redirects</h1>

        <p class="lead">Tot nu toe was de beveiliging alleen visueel. Nu gaan we de routes echt beveiligen met <strong>Middleware</strong>. Daarnaast zorgen we ervoor dat gebruikers na het inloggen netjes op de homepage terechtkomen, waarna admins door kunnen klikken naar het beheergedeelte.</p>

        <section class="learning-outcomes">
            <h2>Leeruitkomsten</h2>
            <p>Na het afronden van deze les kun je:</p>
            <ul>
                <li>Uitleggen wat Middleware is en hoe je dit registreert.</li>
                <li>Routes beveiligen op basis van rollen (Admin/Sales).</li>
                <li><strong>Livewire Components</strong> aanpassen om redirects te wijzigen.</li>
                <li>Frontend styling bouwen met NPM.</li>
            </ul>
        </section>

        <hr>

        <h2>Stap 1: Styling Fixen (NPM)</h2>
        <p>
            Ziet je login-scherm eruit als platte tekst zonder opmaak? Dat komt omdat Livewire en Laravel Breeze <strong>Vite</strong> gebruiken voor de CSS. Je moet de bestanden eenmalig compileren.
        </p>
        <pre><code class="language-bash">npm install && npm run build</code></pre>

        <hr>

        <h2>Stap 2: Middleware Registreren</h2>
        <p>
            We gebruiken de Spatie package. We moeten Laravel eerst vertellen welke afkortingen (aliassen) we willen gebruiken voor de beveiliging.
            Open <strong>bootstrap/app.php</strong>.
        </p>

        <pre><code class="language-php">->withMiddleware(function (Middleware $middleware) {
    // Voeg dit blok toe:
    $middleware->alias([
        'role' => \Spatie\Permission\Middleware\RoleMiddleware::class,
        'permission' => \Spatie\Permission\Middleware\PermissionMiddleware::class,
        'role_or_permission' => \Spatie\Permission\Middleware\RoleOrPermissionMiddleware::class,
    ]);
})</code></pre>

        <hr>

        <h2>Stap 3: Routes Beveiligen</h2>
        <p>
            Nu de aliassen werken, beveiligen we de admin-routes in <strong>routes/web.php</strong>.
            We gebruiken de middleware <code>role:admin|sales</code>.
        </p>

        <pre><code class="language-php">use App\Http\Controllers\Admin\CategoryController;

Route::middleware(['auth', 'role:admin|sales'])->group(function () {

    // Iedereen in deze groep moet ingelogd zijn EN de juiste rol hebben
    Route::resource('admin/categories', CategoryController::class);

});</code></pre>

        <div class="info-box tip">
            <p><strong>Testen:</strong> Probeer als 'Customer' naar <code>/admin/categories</code> te gaan. Je krijgt nu een <strong>403 Forbidden</strong> foutmelding. Dat is goed!</p>
        </div>

        <hr>

        <h2>Stap 4: Livewire Redirects Aanpassen</h2>
        <p>
            Je gebruikt de <strong>Livewire</strong> stack voor authenticatie. De inlog-logica zit dus in PHP-componenten in de map <code>app/Livewire/Auth</code>.
        </p>
        <p>
            We willen dat gebruikers na het inloggen op de <strong>Homepagina</strong> komen.
        </p>

        <h3>4.1 Login Component</h3>
        <p>
            Open <code>app/Livewire/Auth/Login.php</code> en zoek de <code>login()</code> methode.
        </p>
        <pre><code class="language-php">
// Oude situatie:
// $this->redirectIntended(default: route('dashboard', absolute: false), navigate: true);

// NIEUWE situatie:
$this->redirectIntended(default: route('home', absolute: false), navigate: true);
        </code></pre>

        <h3>4.2 Register Component</h3>
        <p>
            Open <code>app/Livewire/Auth/Register.php</code> en zoek de <code>register()</code> methode.
        </p>
        <pre><code class="language-php">
// NIEUWE situatie:
$this->redirect(route('home', absolute: false), navigate: true);
        </code></pre>

        <hr>

        <h2>Stap 5: Navigatie (Blade)</h2>
        <p>
            Nu iedereen op de homepagina landt, moeten de Admins en Sales-medewerkers natuurlijk wel een knop hebben om naar het beheergedeelte te gaan.
            Open <code>resources/views/layouts/base/navbar.blade.php</code>.
        </p>
        <p>Gebruik een gewone <code>href</code> link (geen wire:navigate).</p>

        <pre><code class="language-html">
@auth
    @hasanyrole('admin|sales')
        <a href="{{ route('categories.index') }}">Admin Paneel</a>
    @endhasanyrole
@endauth
        </code></pre>

        <div class="info-box warning">
            <p><strong>Samenvatting</strong><br>
                Je hebt nu een veilige en logische flow:<br>
                1. <strong>Inloggen:</strong> Je landt op de Homepagina.<br>
                2. <strong>Beveiliging:</strong> Middleware bewaakt de admin-routes.<br>
                3. <strong>Navigatie:</strong> Alleen bevoegden zien de knop "Admin Paneel".</p>
        </div>

    </main>

    <aside class="sidebar-right">
        <div class="toc-container">
            <h4>Inhoud</h4>
            <ul id="toc-list" class="toc-list">
            </ul>
        </div>
    </aside>
</div>

<div data-include="../../../../components/footer.html"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="../../../../assets/js/script.js"></script>
</body>
</html>