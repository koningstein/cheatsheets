<!DOCTYPE html>
<html lang="nl" data-theme="light" data-color="red">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Model & Migration - Laravel 12 Module 1</title>
    <script src="../../theme-init.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="../../style.css">
</head>
<body>

<div data-include="../../header.html"></div>

<div class="layout-wrapper">
    <div data-include="../../sidebar.html"></div>

    <main class="main-content">
        <h1>Middleware bij Routes</h1>
        <p>In de vorige modules hebben we gebruikers aangemaakt en de knop naar het admin-paneel verborgen. Maar, zoals we al waarschuwden: het verbergen van een knop is geen beveiliging. Iemand die de URL raadt, kan er nog steeds bij.</p>
        <p>Om routes Ã©cht te beveiligen, gebruiken we <strong>Middleware</strong>. Middleware is een stuk code dat tussen het verzoek van de gebruiker en jouw controller in zit. Het fungeert als een poortwachter: voldoet de gebruiker aan de eisen? Zo ja, mag hij door. Zo nee, wordt hij tegengehouden.</p>

        <div class="info-box" style="background: var(--bg-content); border: 1px solid var(--border-color); padding: 1rem; border-radius: 0.5rem;">
            <h2>Leeruitkomsten</h2>
            <ul style="margin-bottom: 0;">
                <li>Ik begrijp wat Middleware is en wat het doel ervan is (Gatekeeper pattern).</li>
                <li>Ik kan routes groeperen (Route Groups) om code te organiseren.</li>
                <li>Ik kan de standaard <code>auth</code> middleware toepassen op routes.</li>
                <li>Ik kan testen of niet-ingelogde gebruikers worden omgeleid naar de login pagina.</li>
            </ul>
        </div>

        <h2>Het Concept: The Gatekeeper</h2>
        <p>Stel je een nachtclub voor. Je hebt de dansvloer (jouw Controller) en de rij buiten (het Request). De uitsmijter bij de deur is de <strong>Middleware</strong>. Hij checkt of je op de gastenlijst staat (Authentication) en of je oud genoeg bent (Authorization).</p>
        <p>In Laravel werkt het precies zo:</p>
        <ol>
            <li>Request komt binnen.</li>
            <li>Middleware checkt: "Is deze gebruiker ingelogd?"</li>
            <li>Nee? -> Redirect naar Login pagina.</li>
            <li>Ja? -> Laat het verzoek door naar de Controller.</li>
        </ol>

        <h2>Route Groups</h2>
        <p>Je kunt middleware per route instellen, maar dat wordt al snel onoverzichtelijk als je 20 admin-routes hebt. Daarom gebruiken we <strong>Route Groups</strong>. Hiermee bundel je routes die dezelfde eigenschappen (zoals beveiliging of URL-prefix) delen.</p>

        <p>Open <code>routes/web.php</code>. Waarschijnlijk heb je nu zoiets:</p>

        <pre><code class="language-php">
// Dit is herhaling en foutgevoelig:
Route::resource('admin/categories', CategoryController::class)->middleware('auth');
Route::resource('admin/products', ProductController::class)->middleware('auth');
Route::resource('admin/users', UserController::class)->middleware('auth');
        </code></pre>

        <p>Dit gaan we opschonen met een groep:</p>

        <pre><code class="language-php">
use Illuminate\Support\Facades\Route;

// Alles binnen deze groep is beveiligd met 'auth'
Route::middleware(['auth'])->group(function () {

    // Al deze routes vallen nu onder de beveiliging
    Route::resource('admin/categories', CategoryController::class);
    Route::resource('admin/products', ProductController::class);
    Route::resource('admin/users', UserController::class);

    // Je kunt hier ook de dashboard route toevoegen
    Route::get('/dashboard', function () {
        return view('dashboard');
    })->name('dashboard');

});
        </code></pre>

        <h2>Prefix & Name Prefixes</h2>
        <p>Je ziet dat we bij elke route <code>admin/</code> in de URL typen. Ook dit kunnen we groeperen. Hetzelfde geldt voor de namen van de routes (die beginnen vaak met <code>admin.</code>).</p>
        <p>We maken de groep nog krachtiger:</p>

        <pre><code class="language-php">
Route::middleware(['auth'])
    ->prefix('admin')        // Alle URL's beginnen met /admin/...
    ->name('admin.')         // Alle route-namen beginnen met admin...
    ->group(function () {

        // Oude URL: admin/categories
        // Oude Naam: admin.categories.index
        // Nieuwe definitie:
        Route::resource('categories', CategoryController::class);

        Route::resource('users', UserController::class);

        // Dashboard wordt nu bereikbaar via /admin/dashboard
        Route::get('/dashboard', function () {
            return view('dashboard');
        })->name('dashboard');
});
        </code></pre>

        <div class="info-box" style="background: var(--bg-content); border: 1px solid var(--border-color); padding: 1rem; border-radius: 0.5rem;">
            <strong>Let op je route namen!</strong><br>
            Als je in je code (bijv. in views of controllers) verwees naar <code>route('admin.categories.index')</code>, dan blijft dat werken omdat we <code>->name('admin.')</code> hebben toegevoegd.
            <br>
            Maar... als je handmatig URL's had getypt in je HTML (wat je niet zou moeten doen!), dan moet je controleren of de prefix klopt.
        </div>

        <h2>Testen</h2>
        <p>Het is cruciaal om te testen of je beveiliging werkt.</p>
        <ol>
            <li>Zorg dat je bent <strong>uitgelogd</strong>.</li>
            <li>Probeer handmatig naar <code>http://jouw-site.test/admin/categories</code> te gaan.</li>
            <li>Als het goed is, word je nu automatisch doorgestuurd naar de login pagina.</li>
            <li>Log in.</li>
            <li>Probeer de pagina nog eens te openen. Nu zou je er wel in moeten kunnen.</li>
        </ol>

        <h2>Wat is 'auth'?</h2>
        <p>Je vraagt je misschien af waar die string <code>'auth'</code> vandaan komt. Dit is een alias voor de class <code>Illuminate\Auth\Middleware\Authenticate</code>.</p>
        <p>In oudere Laravel versies (voor versie 11) stonden deze aliassen in <code>app/Http/Kernel.php</code>. In Laravel 11 wordt dit veelal automatisch geregeld of geconfigureerd in <code>bootstrap/app.php</code>.</p>
        <p>De <code>auth</code> middleware controleert simpelweg: "Is er een sessie met een User ID?". Zo niet, dan gooit hij een <code>AuthenticationException</code>, die door Laravel wordt opgevangen en omgezet in een redirect naar de login route.</p>

        <div class="info-box" style="background: var(--bg-content); border: 1px solid var(--border-color); padding: 1rem; border-radius: 0.5rem;">
            <strong>Volgende stap:</strong><br>
            We hebben nu geregeld dat je ingelogd moet zijn om bij de admin te komen. Maar... een gewone klant kan nu ook inloggen en bij de admin komen!
            <br><br>
            In de volgende module gaan we onze eigen middleware schrijven om te checken of iemand ook echt <strong>Admin</strong> is.
        </div>

    </main>

    <aside class="sidebar-right">
        <div class="toc-container">
            <h4>Inhoud</h4>
            <ul id="toc-list" class="toc-list">
            </ul>
        </div>
    </aside>
</div>
<div data-include="../../footer.html"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="../../script.js"></script>
</body>
</html>