<!DOCTYPE html>
<html lang="nl" data-theme="light" data-color="red">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 2-4: Users Seeden & Koppelen - Laravel 12 Module 2</title>

    <script src="../../../../assets/js/theme-init.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="../../../../assets/css/style.css">
</head>
<body>

<div data-include="../../../../components/header.html"></div>

<div class="layout-wrapper">
    <div data-include="../../../../components/sidebar.html"></div>

    <main class="main-content">
        <h1>Module 2-4: Users Seeden & Koppelen</h1>

        <p class="lead">We hebben nu rollen (Admin, Sales, Customer), maar nog geen gebruikers die deze rollen hebben. Om goed te kunnen testen, willen we niet steeds handmatig via een registratieformulier accounts hoeven aanmaken. We gaan dit automatiseren met een <strong>UserSeeder</strong>.</p>

        <section class="learning-outcomes">
            <h2>Leeruitkomsten</h2>
            <p>Na het afronden van deze les kun je:</p>
            <ul>
                <li>Een specifieke Seeder aanmaken voor gebruikers.</li>
                <li>Laravel <strong>Factories</strong> gebruiken om snel testdata te genereren.</li>
                <li>Wachtwoorden veilig opslaan met <strong>Hashing</strong>.</li>
                <li>Gebruikers direct bij het aanmaken koppelen aan een Rol (Spatie).</li>
                <li>De volgorde van Seeders beheren in de <code>DatabaseSeeder</code>.</li>
            </ul>
        </section>

        <hr>

        <h2>Stap 1: De UserSeeder Aanmaken</h2>
        <p>
            We hebben al een `RoleAndPermissionSeeder`, nu maken we er eentje speciaal voor gebruikers.
        </p>
        <pre><code class="language-bash">php artisan make:seeder UserSeeder</code></pre>

        <hr>

        <h2>Stap 2: Users met Vaste Gegevens</h2>
        <p>
            Standaard maakt een Factory ("fabriek") willekeurige data (random namen, random emails). Dat is leuk voor bulk-data, maar onhandig als je wilt inloggen. Je weet immers het willekeurig gegenereerde e-mailadres niet.
        </p>
        <p>
            Daarom gaan we de factory <strong>overschrijven</strong>. We dwingen specifieke namen en e-mailadressen af, zodat we zeker weten dat we kunnen inloggen als Admin of Sales.
        </p>

        <h3>De Code</h3>
        <p>Open <code>database/seeders/UserSeeder.php</code>. Zorg dat je bovenin de juiste `use` statements hebt staan, vooral voor `Hash` en `User`.</p>

        <pre><code class="language-php">
namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\User;
use Illuminate\Support\Facades\Hash;

class UserSeeder extends Seeder
{
    public function run(): void
    {
        // 1. Maak de ADMIN aan
        // We gebruiken factory()->create([...]) om de standaard random waardes te overschrijven.
        $admin = User::factory()->create([
            'name' => 'Admin',
            'email' => 'admin@webshop.nl',
            'password' => Hash::make('test1234') // Veilig hashen!
        ]);

        // Koppel direct de rol. Dankzij de 'HasRoles' trait uit de vorige les kan dit:
        $admin->assignRole('admin');


        // 2. Maak de SALES medewerker aan
        $sales = User::factory()->create([
            'name' => 'Sales',
            'email' => 'sales@webshop.nl',
            'password' => Hash::make('test1234')
        ]);
        $sales->assignRole('sales');


        // 3. Maak de CUSTOMER (Klant) aan
        $customer = User::factory()->create([
            'name' => 'Customer',
            'email' => 'customer@webshop.nl',
            'password' => Hash::make('test1234')
        ]);
        $customer->assignRole('customer');
    }
}
        </code></pre>

        <div class="info-box tip">
            <p><strong>Waarom Hash::make?</strong><br>
                Wachtwoorden slaan we <strong>nooit</strong> als platte tekst op. Als je database gehackt wordt, liggen alle wachtwoorden op straat. <code>Hash::make()</code> verandert 'test1234' in een onleesbare reeks tekens (bijv. <code>$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi</code>). Laravel checkt bij het inloggen of het ingevoerde wachtwoord matcht met deze hash.</p>
        </div>

        <hr>

        <h2>Stap 3: Volgorde in DatabaseSeeder</h2>
        <p>
            Nu moeten we Laravel vertellen dat deze nieuwe seeder uitgevoerd moet worden. Dit doen we in de master-seeder: <code>DatabaseSeeder.php</code>.
        </p>
        <p>
            <strong>De volgorde is cruciaal!</strong> Je kunt geen rol aan een gebruiker geven als die rol nog niet bestaat in de database.
        </p>

        <pre><code class="language-php">
public function run(): void
{
    $this->call([
        // 1. EERST de rollen en permissies aanmaken
        RoleAndPermissionSeeder::class,

        // 2. DAN PAS de gebruikers maken (want die hebben de rollen nodig)
        UserSeeder::class,

        // 3. Daarna eventuele andere data (zoals CategorieÃ«n)
        // CategorySeeder::class,
    ]);
}
        </code></pre>

        <hr>

        <h2>Stap 4: Uitvoeren en Testen</h2>
        <p>
            Om alles vers in de database te zetten, wissen we de oude data en draaien we de seeders opnieuw.
        </p>
        <pre><code class="language-bash">php artisan migrate:fresh --seed</code></pre>

        <p>Als alles goed is gegaan, zie je groene vinkjes bij alle seeders.</p>

        <h3>Controleren in de Database (PhpMyAdmin)</h3>
        <p>Als je nu in je database kijkt, zie je:</p>
        <ul>
            <li>In de tabel <code>users</code> staan 3 gebruikers.</li>
            <li>In de tabel <code>roles</code> staan 3 rollen.</li>
            <li>In de tabel <code>model_has_roles</code> (de koppeltabel) zie je dat user ID 1 gekoppeld is aan rol ID 3 (Admin), enzovoorts.</li>
        </ul>

        <h2>Samenvatting</h2>
        <p>
            Je testomgeving is nu klaar voor gebruik!
        </p>
        <ul>
            <li>Je hoeft niet meer handmatig te registreren.</li>
            <li>Je hebt vaste inloggegevens (bijv. <code>admin@webshop.nl</code>) om je applicatie mee te testen.</li>
            <li>De koppeling tussen Users en Roles wordt automatisch gelegd.</li>
        </ul>

    </main>

    <aside class="sidebar-right">
        <div class="toc-container">
            <h4>Inhoud</h4>
            <ul id="toc-list" class="toc-list">
            </ul>
        </div>
    </aside>
</div>

<div data-include="../../../../components/footer.html"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="../../../../assets/js/script.js"></script>
</body>
</html>