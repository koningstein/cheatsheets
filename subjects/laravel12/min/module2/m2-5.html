<!DOCTYPE html>
<html lang="nl" data-theme="light" data-color="red">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 2-5: Middleware & Redirects - Laravel 12 Module 2</title>

    <script src="../../../../assets/js/theme-init.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="../../../../assets/css/style.css">
</head>
<body>

<div data-include="../../../../components/header.html"></div>

<div class="layout-wrapper">
    <div data-include="../../../../components/sidebar.html"></div>

    <main class="main-content">
        <h1>Module 2-5: Middleware & Redirects (Livewire)</h1>
        <p class="lead">We gaan de routes beveiligen zodat alleen bevoegde gebruikers (Admin/Sales) toegang krijgen. Daarnaast zorgen we dat admins via het menu naar het beheerdersgedeelte kunnen.</p>

        <section class="learning-outcomes">
            <h2>Leeruitkomsten</h2>
            <p>Na het afronden van deze les kun je:</p>
            <ul>
                <li>Middleware aliassen registreren in <code>bootstrap/app.php</code>.</li>
                <li>Routes beveiligen op basis van rollen in <code>web.php</code>.</li>
                <li>De redirect logica in <strong>Livewire Auth Components</strong> beheren.</li>
                <li>Frontend assets compileren met NPM.</li>
            </ul>
        </section>

        <hr>

        <h2>Stap 1: Middleware Registreren</h2>
        <p>
            Laravel moet weten welke namen (aliassen) we gebruiken voor de Spatie middleware. Open <strong>bootstrap/app.php</strong> en voeg de aliassen toe.
        </p>

        <pre><code class="language-php">->withMiddleware(function (Middleware $middleware) {
    $middleware->alias([
        'role' => \Spatie\Permission\Middleware\RoleMiddleware::class,
        'permission' => \Spatie\Permission\Middleware\PermissionMiddleware::class,
        'role_or_permission' => \Spatie\Permission\Middleware\RoleOrPermissionMiddleware::class,
    ]);
})</code></pre>

        <hr>

        <h2>Stap 2: Routes Beveiligen</h2>
        <p>
            Open <strong>routes/web.php</strong>. We zorgen ervoor dat de categorie-routes alleen toegankelijk zijn voor 'admin' of 'sales'.
        </p>

        <pre><code class="language-php">use App\Http\Controllers\Admin\CategoryController;

Route::middleware(['auth', 'role:admin|sales'])->group(function () {

    // Alleen Admins en Sales mogen hier komen
    Route::resource('admin/categories', CategoryController::class);

});</code></pre>

        <hr>

        <h2>Stap 3: Livewire Redirects Instellen</h2>
        <p>
            Standaard staat Laravel Breeze ingesteld op <code>dashboard</code>. Wij veranderen dit naar <code>home</code>.
            <br>
            <em>Let op: We verwijderen <code>navigate: true</code> omdat we na het inloggen naar een gewone Blade layout gaan.</em>
        </p>

        <h3>3.1 Login Component</h3>
        <p>Open <code>app/Livewire/Auth/Login.php</code>. Zoek de methode <code>login()</code>:</p>
        <pre><code class="language-php">
$this->redirectIntended(default: route('home', absolute: false), navigate: true);</code></pre>

        <h3>3.2 Register Component</h3>
        <p>Open <code>app/Livewire/Auth/Register.php</code>. Zoek de methode <code>register()</code>:</p>
        <pre><code class="language-php">
$this->redirect(route('home', absolute: false), navigate: true);</code></pre>

        <hr>

        <h2>Stap 4: Styling & Navigatie</h2>

        <h3>4.1 Styling fixen (NPM)</h3>
        <p>Als je login-scherm geen opmaak heeft, draai dan dit commando:</p>
        <pre><code class="language-bash">npm install && npm run build</code></pre>

        <h3>4.2 Navigatie aanpassen</h3>
        <p>Open <code>resources/views/layouts/base/navbar.blade.php</code>. Zorg dat admins een knop zien om naar het beveiligde gedeelte te gaan:</p>

        <pre><code class="language-html">@auth
    @hasanyrole('admin|sales')
        <a href="{{ route('categories.index') }}">Admin Paneel</a>
    @endhasanyrole
@endauth</code></pre>

    </main>

    <aside class="sidebar-right">
        <div class="toc-container">
            <h4>Inhoud</h4>
            <ul id="toc-list" class="toc-list">
            </ul>
        </div>
    </aside>
</div>

<div data-include="../../../../components/footer.html"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="../../../../assets/js/script.js"></script>
</body>
</html>