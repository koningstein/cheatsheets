<!DOCTYPE html>
<html lang="nl" data-theme="light" data-color="red">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTTP Client</title>

    <script src="../../../../assets/js/theme-init.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="../../../../assets/css/style.css">
</head>
<body>

<div data-include="../../../../components/header.html"></div>

<div class="layout-wrapper">
    <div data-include="../../../../components/sidebar.html"></div>

    <main class="main-content">
        <h1>HTTP Client</h1>
        <p>Moderne applicaties staan zelden op zichzelf. Ze communiceren met externe services: een weer-API, een betaalprovider (Mollie/Stripe), OpenAI, of interne microservices. Vroeger gebruikte je hiervoor Guzzle of cURL, wat nogal omslachtige code opleverde. Laravel biedt een prachtige wrapper om Guzzle heen: de <strong>Http Facade</strong>.</p>

        <h2>Leeruitkomsten</h2>
        <ul style="margin-bottom: 2rem;">
            <li>Ik kan data ophalen van een externe API met de Http Facade (GET).</li>
            <li>Ik kan data versturen naar een externe API met authenticatie (POST).</li>
            <li>Ik weet hoe ik externe API calls kan faken (mocken) in mijn tests.</li>
        </ul>

        <h3>Waarom: Eenvoud en Leesbaarheid</h3>
        <p>De Http Facade maakt API calls leesbaar en testbaar. Je kunt eenvoudig headers toevoegen, authenticatie regelen en de response verwerken zonder in try-catch blokken te verdrinken.</p>

        <h3>Hoe: Een GET Request doen</h3>
        <p>Stel we willen weerdata ophalen van een externe API.</p>

        <div class="note-box">Bestand: <code>app/Services/WeatherService.php</code></div>
        <pre><code class="language-php">
use Illuminate\Support\Facades\Http;

public function getForecast(string $city)
{
    // Doe het request
    $response = Http::get('https://api.weather.com/v1/forecast', [
        'city' => $city,
        'apikey' => config('services.weather.key'),
    ]);

    // Check of het gelukt is (status 200-299)
    if ($response->successful()) {
        return $response->json(); // Geeft array terug
    }

    // Foutafhandeling
    if ($response->failed()) {
        // Log de error of gooi een exception
        throw new \Exception('Kan weerdata niet ophalen: ' . $response->status());
    }
}
        </code></pre>

        <h3>Hoe: Een POST Request met Authenticatie</h3>
        <p>Veel API's vereisen een Bearer Token. De Http client heeft hier handige helpers voor.</p>

        <pre><code class="language-php">
$response = Http::withToken('mijn-geheime-api-token')
    ->post('https://api.example.com/users', [
        'name' => 'Henk',
        'role' => 'admin',
    ]);

// Als je verwacht dat het altijd goed gaat, kun je throw() gebruiken.
// Dit gooit automatisch een Exception als de status code >= 400 is.
$data = $response->throw()->json();
        </code></pre>

        <h3>Testen (Mocking)</h3>
        <p>Het grootste voordeel van de Http Facade is tijdens het testen. Je wilt in je tests niet Ã©cht naar de externe API verbinden (traag, kost geld, offline niet mogelijk). Je kunt requests 'mocken' (faken).</p>

        <div class="note-box">Bestand: <code>tests/Feature/WeatherTest.php</code></div>
        <pre><code class="language-php">
Http::fake([
    'api.weather.com/*' => Http::response(['temp' => 20], 200),
]);

// Nu zal je applicatie denken dat het 20 graden is, zonder internetverbinding.
        </code></pre>
    </main>
    <aside class="sidebar-right">
        <div class="toc-container">
            <h4>Inhoud</h4>
            <ul id="toc-list" class="toc-list">
            </ul>
        </div>
    </aside>
</div>

<div data-include="../../../../components/footer.html"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="../../../../assets/js/script.js"></script>
</body>
</html>