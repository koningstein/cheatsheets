<!DOCTYPE html>
<html lang="nl" data-theme="light" data-color="red">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Policies</title>

    <script src="../../../../assets/js/theme-init.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="../../../../assets/css/style.css">
</head>
<body>

<div data-include="../../../../components/header.html"></div>

<div class="layout-wrapper">
    <div data-include="../../../../components/sidebar.html"></div>

    <main class="main-content">
        <h1>Policies</h1>
        <p>Waar Gates handig zijn voor algemene checks, zijn <strong>Policies</strong> bedoeld voor autorisatie rondom een specifiek Model. De vraag is niet "Mag ik in het admin panel?", maar "Mag ik <em>dit specifieke</em> project bewerken?".</p>
        <p>Een Policy is een PHP class die hoort bij een Model (bijv. <code>ProjectPolicy</code> hoort bij <code>Project</code>). Hierin definieer je methodes voor de standaard CRUD-acties: `view`, `create`, `update`, `delete`.</p>

        <h2>Leeruitkomsten</h2>
        <ul style="margin-bottom: 2rem;">
            <li>Ik weet wanneer ik een Policy moet gebruiken in plaats van een Gate.</li>
            <li>Ik kan een Policy aanmaken en koppelen aan een Model.</li>
            <li>Ik kan Policy-methodes schrijven voor CRUD-acties.</li>
            <li>Ik kan Policies toepassen in Livewire en Blade.</li>
        </ul>

        <h3>Stap 1: Policy Aanmaken</h3>
        <p>Gebruik Artisan om een policy te genereren. Als je de optie `--model` meegeeft, vult Laravel de methodes alvast voor je in.</p>

        <div class="note-box">Terminal</div>
        <pre><code class="language-bash">php artisan make:policy ProjectPolicy --model=Project</code></pre>

        <h3>Stap 2: Logica Schrijven</h3>
        <p>Open <code>app/Policies/ProjectPolicy.php</code>. Elke methode krijgt automatisch de ingelogde <code>User</code> en het betreffende <code>Project</code> object mee. Je returnt <code>true</code> als het mag, en <code>false</code> als het niet mag.</p>

        <div class="note-box">Bestand: <code>app/Policies/ProjectPolicy.php</code></div>
        <pre><code class="language-php">
namespace App\Policies;

use App\Models\Project;
use App\Models\User;

class ProjectPolicy
{
    // Mag de user dit project bekijken?
    public function view(User $user, Project $project): bool
    {
        // Ja, als de user lid is van het team van dit project
        return $user->team_id === $project->team_id;
    }

    // Mag de user dit project bewerken?
    public function update(User $user, Project $project): bool
    {
        // Ja, alleen als de user de eigenaar (maker) is
        return $user->id === $project->user_id;
    }

    // Voor admins kun je de 'before' methode gebruiken
    // Deze wordt ALTIJD als eerst uitgevoerd.
    public function before(User $user, string $ability): bool|null
    {
        if ($user->is_admin) {
            return true; // Admins mogen alles
        }
        return null; // Anders: ga door naar de specifieke regel
    }
}
        </code></pre>

        <h3>Stap 3: Gebruik in Livewire</h3>
        <p>In je Livewire component kun je de <code>$this->authorize()</code> helper gebruiken. Omdat je een Model object (hier `$project`) meegeeft, snapt Laravel automatisch dat hij in de <code>ProjectPolicy</code> moet kijken.</p>

        <div class="note-box">Bestand: <code>app/Livewire/Projects/Edit.php</code></div>
        <pre><code class="language-php">
use App\Models\Project;

class Edit extends Component
{
    public Project $project;

    public function mount(Project $project)
    {
        // Laravel ziet: Model is Project -> check ProjectPolicy -> method 'update'
        // Als dit faalt: 403 error.
        $this->authorize('update', $project);

        $this->project = $project;
    }

    public function save()
    {
        // Goede gewoonte: ook bij het opslaan nogmaals checken!
        $this->authorize('update', $this->project);

        $this->project->update([/* ... */]);
    }
}
        </code></pre>

        <h3>Stap 4: Gebruik in Blade</h3>
        <p>Ook hier werkt de <code>@can</code> directive, maar nu geef je het model object mee als tweede parameter.</p>

        <div class="note-box">Bestand: <code>resources/views/projects/index.blade.php</code></div>
        <pre><code class="language-html">
@foreach($projects as $project)
    &lt;div class="card"&gt;
        &lt;h2&gt;{{ $project->title }}&lt;/h2&gt;

        {{-- De knop 'Bewerken' is alleen zichtbaar als de policy 'true' geeft --}}
        @can('update', $project)
            &lt;a href="{{ route('projects.edit', $project) }}"&gt;
                Bewerken
            &lt;/a&gt;
        @endcan
    &lt;/div&gt;
@endforeach
        </code></pre>
    </main>

    <aside class="sidebar-right">
        <div class="toc-container">
            <h4>Inhoud</h4>
            <ul id="toc-list" class="toc-list">
            </ul>
        </div>
    </aside>
</div>

<div data-include="../../../../components/footer.html"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="../../../../assets/js/script.js"></script>
</body>
</html>